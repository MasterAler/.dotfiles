FROM nvidia/cuda:10.1-devel-ubuntu16.04

RUN     apt-get update         \
    &&  apt-get install -y     \
            git                \
            python             \
            python3-pip        \
            debhelper          \
            libpng-dev         \
            libjpeg-turbo8-dev \
            wget               \
            libprotobuf-dev    \
            protobuf-compiler  \
            libssl-dev         \
    &&  pip3 install cmake


RUN     wget -O - https://apt.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS-2019.PUB | apt-key add - \
    &&  echo 'deb https://apt.repos.intel.com/mkl all main' > /etc/apt/sources.list.d/intel-mkl.list                \
    &&  apt-get update                                                                                              \
    &&  apt-get install -y            \
            intel-mkl-core-2019.4-243 \
            intel-mkl-common-c-2019.4-243


RUN     DISTR="ubuntu-16.04"                                                                                                                       \
    &&  wget --no-check-certificate --content-disposition                                                                                          \
            "https://gitlab.int.ntl/ntech/3rdparty/opencv/-/jobs/artifacts/4.1.1/raw/findface-opencv-cpu-4.1.1-amd64-dev.deb?job=${DISTR}"         \
            "https://gitlab.int.ntl/ntech/3rdparty/opencv/-/jobs/artifacts/4.1.1/raw/findface-opencv-gpu-4.1.1-amd64-dev.deb?job=${DISTR}"         \
            "https://gitlab.int.ntl/ntech/3rdparty/tensorrt/-/jobs/artifacts/5.1.5.0/raw/libcudnn7-dev_7.5.0.56-1+cuda10.1_amd64.deb?job=${DISTR}" \
            "https://gitlab.int.ntl/ntech/3rdparty/tensorrt/-/jobs/artifacts/5.1.5.0/raw/libcudnn7_7.5.0.56-1+cuda10.1_amd64.deb?job=${DISTR}"     \
            "https://gitlab.int.ntl/ntech/3rdparty/tensorrt/-/jobs/artifacts/5.1.5.0/raw/libnvinfer-dev_5.1.5-1+cuda10.1_amd64.deb?job=${DISTR}"   \
            "https://gitlab.int.ntl/ntech/3rdparty/tensorrt/-/jobs/artifacts/5.1.5.0/raw/libnvinfer5_5.1.5-1+cuda10.1_amd64.deb?job=${DISTR}"      \
            "https://gitlab.int.ntl/ntech/3rdparty/multibranch/-/jobs/artifacts/cython3-0.29/raw/cython3_0.29-1_amd64.deb?job=${DISTR}"            \
    &&  dpkg -i *.deb                                                                                                                              \
    &&  rm -f *.deb

CMD /bin/bash
